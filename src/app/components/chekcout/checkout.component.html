<!-- Hero Section -->
<div class="container mt-4 main-section">
  <div class="row align-items-center justify-content-center">
    <div class="col-lg-6 col-md-12 p-5 text-center text-lg-start">
      <h1 class="fw-bold display-4 mb-4">CHECKOUT</h1>
      <p class="lead mb-4">
        Review Your Cart – Your Trusted Source for Premium Scrubs, Lab Coats & Medical Supplies
      </p>
    </div>
    <div class="col-lg-6 col-md-12 text-center">
      <div class="image-container">
        <img src="./assets/images/checkout.png" alt="Checkout Image" class="img-fluid">
      </div>
    </div>
  </div>
</div>

<!-- Billing Details Label -->
<section class="container billing-details mt-5">
  <p class="fs-3 p-2">Billing details</p>
</section>

<!-- Checkout Section -->
@if (!loading) {
  <div class="container my-5">
    <div class="row">
      <!-- Billing & Shipping Column -->
      <div class="col-lg-7">
        <div class="mb-5">
          <h5 class="mb-3">Shipping Address</h5>
          <div class="list-group">
            @if (addresses.length > 0) {
              @for (address of addresses; track address.id) {
                <label class="list-group-item list-group-item-action d-flex">
                  <input class="form-check-input me-3" type="radio" name="savedAddress"
                         [value]="address.id"
                         [checked]="selectedAddressId === address.id"
                         (change)="onAddressChange(address.id)">
                  <div>{{ address.street }}, {{ address.city }}, {{ address.postal_code }}</div>
                  @if (address.shipping_times >= 3) {
                    <span class="badge bg-secondary ms-auto align-self-start">Default</span>
                  }
                </label>
              }
            } @else {
              <div class="list-group-item text-center">
                <p class="mb-0">No addresses available. Please add an address.</p>
              </div>
            }
          </div>


              <app-address-form></app-address-form>

        </div>

        <!-- Shipping Options -->
        <div class="mt-4">
          <h5 class="mb-3">Shipping Method</h5>
          <div class="list-group">
            @for (option of shippingOptions; track option.id) {
              <label class="list-group-item d-flex justify-content-between align-items-center">
                <div class="form-check">
                  <input class="form-check-input"
                         type="radio"
                         name="shippingOption"
                         [id]="option.id"
                         [value]="option.id"
                         [checked]="selectedShippingId === option.id"
                         (change)="onShippingChange(option.id)">
                  <label class="form-check-label ms-2" [for]="option.id">
                    {{ option.name }} ({{ option.estimated_delivery_days }} days)
                  </label>
                </div>
                <span>{{ option.cost === 0 ? 'FREE' : ('EGP' + option.cost.toFixed(2)) }}</span>
              </label>
            }
          </div>
        </div>
      </div>

      <!-- Order Summary Column -->
      <div class="col-lg-5 mt-5 mt-lg-0">
        <div class="bg-light p-3 rounded">
          <h5 class="mb-3">Product</h5>
          @for (item of fullCart; track item.cartId) {
            @if (item.product) {
              <div class="d-flex justify-content-between">
                <span>{{ item.product.name }} ×{{ item.quantity }}</span>
                <span>EGP{{ (item.product.price * item.quantity) | number:'1.2-2' }}</span>
              </div>
            }
          }


          <hr>
          <div class="d-flex justify-content-between fw-bold">
            <span>Subtotal</span>
            <span>EGP{{ subtotal | number:'1.2-2' }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span>Shipping</span>
            <span>{{ shippingCost === 0 ? 'FREE' : ('EGP' + shippingCost.toFixed(2)) }}</span>
          </div>
          <div class="d-flex justify-content-between fw-bold mt-2">
            <span>Total</span>
            <span class="text-muted">EGP{{ total | number:'1.2-2' }}</span>
          </div>
          <hr>

          <!-- Payment Options -->
          <h5 class="mt-4">Payment Method</h5>
          <div class="form-check mb-2">
            <input class="form-check-input" type="radio" name="paymentMethod" id="bank" value="bank"
                   [checked]="selectedPaymentMethod === 'bank'"
                   (change)="onPaymentMethodChange('bank')">
            <label class="form-check-label" for="bank">Direct bank transfer</label>
            <small class="text-muted d-block">Use Order ID as payment reference.</small>
          </div>
          <div class="form-check mb-2">
            <input class="form-check-input" type="radio" name="paymentMethod" id="check" value="check"
                   [checked]="selectedPaymentMethod === 'check'"
                   (change)="onPaymentMethodChange('check')">
            <label class="form-check-label" for="check">Check payments</label>
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="cod"
                   [checked]="selectedPaymentMethod === 'cod'"
                   (change)="onPaymentMethodChange('cod')">
            <label class="form-check-label" for="cod">Cash On Delivery</label>
          </div>

          <button class="btn btn-dark w-100" (click)="placeOrder()">PLACE ORDER</button>
        </div>
      </div>
    </div>
  </div>
} @else {
  <div class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
}
